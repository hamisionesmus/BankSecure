@echo off

REM FREE HOSTING DEPLOYMENT SCRIPT FOR WINDOWS
REM Neon + Vercel = 100% FREE

echo üöÄ FREE ATM System Deployment (Neon + Vercel)
echo ==================================================
echo.

REM Check if we're in the right directory
if not exist "package.json" (
    echo ‚ùå Error: Please run this script from the project root directory
    echo    cd c:\xampp\htdocs\AAssignement
    pause
    exit /b 1
)

if not exist "api" (
    echo ‚ùå Error: API directory not found
    echo    Please ensure you're in the correct project directory
    pause
    exit /b 1
)

echo üìÅ Project directory: %cd%
echo.

REM Check if Vercel CLI is installed
echo üì¶ Checking Vercel CLI...
vercel --version >nul 2>&1
if %errorlevel% neq 0 (
    echo üì• Installing Vercel CLI...
    npm install -g vercel
    echo ‚úÖ Vercel CLI installed!
) else (
    echo ‚úÖ Vercel CLI already installed
)

echo.

REM Check if user has Vercel account
echo üîê Checking Vercel account...
vercel whoami >nul 2>&1
if %errorlevel% neq 0 (
    echo ‚ùå You need to login to Vercel first!
    echo.
    echo üìã Please run these commands:
    echo    vercel login
    echo    # Follow the browser prompts to authenticate
    echo.
    echo üí° Then run this script again:
    echo    deploy-free.bat
    pause
    exit /b 1
)

echo ‚úÖ Vercel account authenticated!
echo.

REM Show current project status
echo üìä Project Status:
if exist "atm-app" (
    echo    ‚úÖ React Frontend: Found
) else (
    echo    ‚ùå React Frontend: Missing
)

if exist "api" (
    echo    ‚úÖ API Routes: Found
) else (
    echo    ‚ùå API Routes: Missing
)

if exist "vercel.json" (
    echo    ‚úÖ Vercel Config: Found
) else (
    echo    ‚ùå Vercel Config: Missing
)

echo.

REM Deploy to Vercel
echo üì§ Starting Vercel Deployment...
echo    This will create your FREE hosting!
echo    Project will be available at: https://your-app.vercel.app
echo.

REM Run deployment with specific settings
echo üîß Deployment Configuration:
echo    - Project Name: atm-system-free
echo    - Directory: %cd%
echo    - Build Command: npm run build (for React app)
echo.

vercel --prod --yes

echo.
echo üéâ DEPLOYMENT COMPLETE!
echo ======================
echo.

echo üìã IMMEDIATE NEXT STEPS:
echo ========================
echo.

echo 1. üåê COPY YOUR LIVE URL:
echo    The URL shown above is your live website!
echo    Example: https://atm-system-free-abc123.vercel.app
echo.

echo 2. üóÑÔ∏è  SET UP FREE DATABASE (REQUIRED):
echo    ==================================
echo    ‚Ä¢ Go to: https://neon.tech
echo    ‚Ä¢ Click: 'Sign up'
echo    ‚Ä¢ Choose: 'Continue with GitHub' or 'Continue with Google' or 'Continue with email'
echo    ‚Ä¢ Click: 'Create a project'
echo    ‚Ä¢ Name: 'atm-system' (exactly)
echo    ‚Ä¢ PostgreSQL Version: Keep default
echo    ‚Ä¢ Region: Choose closest to you
echo    ‚Ä¢ Click: 'Create project'
echo    ‚Ä¢ Wait: 30 seconds for creation
echo    ‚Ä¢ Click: 'Dashboard' tab
echo    ‚Ä¢ Scroll to: 'Connection Details'
echo    ‚Ä¢ Copy: Connection string and parameters
echo    ‚Ä¢ Click: 'SQL Editor' in left sidebar
echo    ‚Ä¢ Click: 'New Query'
echo    ‚Ä¢ Copy: ALL content from 'setup-free-database-postgres.sql'
echo    ‚Ä¢ Paste: Into the SQL editor
echo    ‚Ä¢ Click: 'Run' button
echo.

echo 3. ‚öôÔ∏è  CONFIGURE ENVIRONMENT VARIABLES:
echo    ================================
echo    ‚Ä¢ Go to: https://vercel.com/dashboard
echo    ‚Ä¢ Click: Your project (atm-system-free)
echo    ‚Ä¢ Click: 'Settings' tab
echo    ‚Ä¢ Click: 'Environment Variables'
echo    ‚Ä¢ Click: 'Add New' for each:
echo.
echo    DATABASE_URL = postgresql://neondb_owner:npg_l1ncmz8sxdkq@ep-wild-moon-a1fa5rb5-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
echo.

echo 4. üîÑ REDEPLOY WITH DATABASE:
echo    ========================
echo    vercel --prod
echo.

echo 5. üß™ TEST YOUR LIVE SYSTEM:
echo    =======================
echo    ‚Ä¢ Visit: Your Vercel URL
echo    ‚Ä¢ Login with:
echo       - Card Number: 123456789
echo       - PIN: 1234
echo    ‚Ä¢ Try: Withdraw $50
echo    ‚Ä¢ Check: Transaction History
echo.

echo üí° FREE SERVICE LIMITS:
echo    ==================
echo    ‚Ä¢ Vercel: 100GB bandwidth, 3000 function seconds/month
echo    ‚Ä¢ Neon: 512MB PostgreSQL, 100 hours compute time/month
echo    ‚Ä¢ Both services are completely FREE for your usage!
echo.

echo üéØ TROUBLESHOOTING:
echo    ===============
echo    ‚Ä¢ If login fails: Check environment variables
echo    ‚Ä¢ If transactions don't work: Verify database connection
echo    ‚Ä¢ If page doesn't load: Check Vercel function logs
echo.

echo üöÄ YOUR ATM SYSTEM IS NOW LIVE AND 100% FREE!
echo ==============================================
echo.

echo Need help? Check the README-FREE-HOSTING.md file! üìñ

pause